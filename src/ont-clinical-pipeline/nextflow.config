manifest {
    name            = 'ont-clinical-pipeline'
    author          = 'Bioinformatics Team'
    description     = 'Postgres-integrated ONT Variant Calling Pipeline'
    nextflowVersion = '>=23.04.0'
}

// Default parameters
params {
    sample = null
    outdir = './results'
}

profiles {
    // 1. Local execution profile (default)
    standard {
        process.executor = 'local'
        docker.enabled = true
        docker.runOptions = '-u $(id -u):$(id -g)' // Prevents permission errors on local outputs
    }

    // 2. Future AWS Batch profile
    awsbatch {
        process.executor = 'awsbatch'
        process.queue = 'my-aws-batch-queue-name'
        aws.region = 'us-east-1'
        // Nextflow will automatically use S3 for all intermediate files
        workDir = 's3://my-nextflow-work-bucket/work'
        docker.enabled = true
    }
}

// Map specific tools to their respective Docker containers
process {
    withName: 'MINIMAP2_ALIGN' {
        container = 'staphb/minimap2:2.26'
        cpus = 4
        memory = '8 GB'
    }
    withName: 'SAMTOOLS_SORT' {
        container = 'staphb/samtools:1.17'
        cpus = 2
    }
    withName: 'CALL_VARIANTS' {
        container = 'staphb/bcftools:1.17'
        cpus = 2
    }
    // We assume your python scripts run in a standard python environment with psycopg2 installed
    withName: 'FETCH_DB_INPUTS|LOG_DB_OUTPUTS' {
        container = 'python:3.9-slim' 
    }
}